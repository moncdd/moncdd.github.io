<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>4.3. Manejo de sesiones | Unidad 04 </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.8 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-51"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">Unidad 04</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Unidad 4. Desarrollo de aplicaciones web utilizando código embebido</a></li>
   <li><a href="41_autentificacin_de_usuarios_y_control_de_acceso.html" class="no-ch">4.1. Autentificación de usuarios y control de acceso</a></li>
   <li><a href="42_cookies.html" class="no-ch">4.2. Cookies</a></li>
   <li id="active"><a href="43_manejo_de_sesiones.html" class="active no-ch">4.3. Manejo de sesiones</a></li>
   <li><a href="44_mecanismos_de_mantenimiento_del_estado.html" class="no-ch">4.4. Mecanismos de mantenimiento del estado</a></li>
   <li><a href="45_ejercicios.html" class="no-ch">4.5. Ejercicios</a></li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="42_cookies.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="44_mecanismos_de_mantenimiento_del_estado.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">4.3. Manejo de sesiones</h1></header>
<article class="iDevice_wrapper textIdevice" id="id123">
<div class="iDevice emphasis0" >
<div id="ta123_123_2" class="block iDevice_content">
<div class="exe-text"><p>Como se acaba de ver, una forma para guardar información particular de cada usuario es utilizar cookies. Sin embargo, existen diversos problemas asociados a las cookies, como el número de ellas que admite el navegador, o su tamaño máximo. Para solventar estos inconvenientes, existen las <strong>sesiones</strong>. El término sesión hace referencia al conjunto de información relativa a un usuario concreto. Esta información puede ser tan simple como el nombre del propio usuario, o más compleja, como los artículos que ha depositado en la cesta de compra de una tienda online.</p>
<p>Cada usuario distinto de un sitio web tiene su propia información de sesión. Para distinguir una sesión de otra se usan los <strong>identificadores de sesión.</strong> Un <strong>SID</strong> es un <strong>atributo que se</strong> <strong>asigna a cada uno de los visitantes de un sitio web y lo identifica.</strong> De esta forma, si el servidor web conoce el SID de un usuario, puede relacionarlo con toda la información que posee sobre él, que se mantiene en la sesión del usuario. Esa información se almacena en el servidor web, generalmente en ficheros aunque también se pueden utilizar otros mecanismos de almacenamiento como bases de datos.</p>
<p>La cuestión ahora es: ¿y dónde se almacena ese SID, el identificador de la sesión, que es único para cada usuario? Pues existen dos maneras de mantener el SID entre las páginas de un sitio web que visita el usuario:</p>
<ul>
<li>Utilizando cookies, tal y como ya viste.</li>
<li>Propagando el SID en un parámetro de la URL. El SID se añade como una parte más de la URL, de la forma: <a href="http://www.misitioweb.com/tienda/listado.php&amp;PHPSESSID=34534fg4ffg34ty">http://www.misitioweb.com/tienda/listado.php&amp;PHPSESSID=34534fg4ffg34ty</a></li>
</ul>
<p>En el ejemplo anterior, el <strong>SID</strong> es el valor del parámetro <strong>PHPSESSID</strong>. Ninguna de las dos maneras es perfecta. Ya se conocen los problemas que tiene la utilización<br />de cookies. Pese a ello, es el mejor método y el más utilizado. Propagar el SID como parte de la URL conlleva mayores desventajas, como la <strong>imposibilidad de mantener el SID</strong><br /><strong>entre distintas sesiones</strong>, o el hecho de que <strong>compartir la URL con otra persona implica compartir también el identificador de sesión.</strong></p>
<p>La buena noticia, es que el proceso de manejo de sesiones en PHP está automatizado en gran medida. Cuando un usuario visita un sitio web, no es necesario programar un<br />procedimiento para ver si existe un SID previo y cargar los datos asociados con el mismo. Tampoco se tiene que utilizar la función setcookie si se quiere almacenar los SID en cookies, o ir pasando el SID entre las páginas web de tu sitio si se decide por propagarlo. Todo esto PHP lo hace automáticamente.</p>
<p>A la información que se almacena en la sesión de un usuario también se le conoce como <strong>cookies del lado del servidor ( server side cookies )</strong>. Se debe tener en cuenta que aunque esta información no viaja entre el cliente y el servidor, <strong>sí lo hace el SID</strong> , bien como parte de la URL o en un encabezado HTTP si se guarda en una cookie . En ambos casos, esto plantea un posible problema de seguridad. <strong>El SID puede ser conseguido por otra persona, </strong><strong>y a partir del mismo obtener la información de la sesión del usuario.</strong></p>
<p>La manera más segura de utilizar sesiones es almacenando los SID en cookies y utilizar HTTPS para encriptar la información que se transmite entre el servidor web y el cliente.</p></div>
</div>
</div>
</article>
<article class="iDevice_wrapper textIdevice em_iDevice" id="id124">
<div class="iDevice emphasis1" >
<header class="iDevice_header iDevice_header_noIcon"><h1 class="iDeviceTitle">4.3.1. Configuración</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta124_124_2" class="block iDevice_content">
<div class="exe-text"><p>Por defecto, PHP incluye soporte de sesiones incorporado. Sin embargo, antes de utilizar sesiones en tu sitio web, se debe configurar correctamente PHP utilizando las siguientes directivas en el fichero php.ini según corresponda:</p>
<p style="text-align: center;">Directivas de configuración de PHP relacionadas con el manejo de sesiones.</p>
<table style="width: 100%;" border="1">
<tbody>
<tr>
<td style="width: 18.2399%;"><strong>Directiva</strong></td>
<td style="width: 81.7601%;"><strong>Significado</strong></td>
</tr>
<tr>
<td style="width: 18.2399%;">session.use_cookies</td>
<td style="width: 81.7601%;">Indica si se deben usar cookies (1) o propagación en la URL (0) para almacenar el SID.</td>
</tr>
<tr>
<td style="width: 18.2399%;">session.use_only_cookies</td>
<td style="width: 81.7601%;">Se debe activar (1) cuando utilizas cookies para almacenar los SID, y además no quieres que se reconozcan los SID que se puedan pasar como parte de la URL (este método se puede usar para usurpar el identificador de otro usuario).</td>
</tr>
<tr>
<td style="width: 18.2399%;">session.save_handler</td>
<td style="width: 81.7601%;">Se utiliza para indicar a PHP cómo debe almacenar los datos de la sesión del usuario. Existen cuatro opciones: en ficheros (files), en memoria (mm), en una base de datos SQLite (sqlite) o utilizando para ello funciones que debe definir el programador (user). El valor por defecto (files) funcionará sin problemas en la mayoría de los casos.</td>
</tr>
<tr>
<td style="width: 18.2399%;">session.name</td>
<td style="width: 81.7601%;">Determina el nombre de la cookie que se utilizará para guardar el SID. Su valor por defecto es PHPSESSID.</td>
</tr>
<tr>
<td style="width: 18.2399%;">session.auto_start</td>
<td style="width: 81.7601%;">Su valor por defecto es 0, y en este caso deberás usar la función session_start para gestionar el inicio de las sesiones.<br />Si usas sesiones en el sitio web, puede ser buena idea<br />cambiar su valor a 1 para que PHP active de forma<br />automática el manejo de sesiones.</td>
</tr>
<tr>
<td style="width: 18.2399%;">session.cookie_lifetime</td>
<td style="width: 81.7601%;">Si utilizas la URL para propagar el SID, éste se perderá<br />cuando cierres tu navegador. Sin embargo, si utilizas cookies,<br />el SID se mantendrá mientras no se destruya la cookie. En su<br />valor por defecto (0), las cookies se destruyen cuando se<br />cierra el navegador. Si quieres que se mantenga el SID<br />durante más tiempo, debes indicar en esta directiva ese<br />tiempo en segundos.</td>
</tr>
<tr>
<td style="width: 18.2399%;">session.gc_maxlifetime</td>
<td style="width: 81.7601%;">Indica el tiempo en segundos que se debe mantener activa la<br />sesión, aunque no haya ninguna actividad por parte del<br />usuario. Su valor por defecto es 1440. Es decir, pasados 24<br />minutos desde la última actividad por parte del usuario, se<br />cierra su sesión automáticamente.</td>
</tr>
</tbody>
</table>
<p style="text-align: left;"></p></div>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper textIdevice em_iDevice" id="id125">
<div class="iDevice emphasis1" >
<header class="iDevice_header iDevice_header_noIcon"><h1 class="iDeviceTitle">4.3.2. Inicio y fin de una sesión</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta125_125_2" class="block iDevice_content">
<div class="exe-text"><p>El inicio de una sesión puede realizarse de dos formas. Si se activa la directiva <strong>session.auto_start</strong> en la configuración de PHP, la sesión comenzará automáticamente en<br />cuanto un usuario se conecte al sitio web. En caso de que ese usuario ya haya abierto una sesión con anterioridad, y esta no se haya eliminado, en lugar de abrir una nueva<br />sesión se reanudará la anterior. Para ello se utilizará el SID anterior, que estará almacenado en una cookie (recuerda que si usas propagación del SID, no se podrá restaurar sesiones anteriores; el SID figura en la URL y se pierde cuando cierras el navegador).</p>
<p>Si por el contrario, se decide no utilizar el inicio automático de sesiones, se debe ejecutar la función <strong>session_start</strong> para indicar a PHP que inicie una nueva sesión o reanude la<br />anterior. Aunque anteriormente esta función devolvía siempre true, a partir de la versión 5.3.0 de PHP su comportamiento es más coherente: devuelve false en caso de no poder iniciar o restaurar la sesión.</p>
<p>Como el inicio de sesión requiere utilizar cookies, y éstas se transmiten en los encabezados HTTP, se debe tener en cuenta que para poder iniciar una sesión utilizando<br />session_start, se tendrá que hacer las llamadas a esta función antes de que la página web muestre información en el navegador. Además, todas las páginas que necesiten utilizar la información almacenada en la sesión, deberán ejecutar la función session_start.</p>
<p>Mientras la sesión permanece abierta, se puede utilizar la variable superglobal<strong> $_SESSION </strong>para añadir información a la sesión del usuario, o para acceder a la información<br />almacenada en la sesión. Por ejemplo, para contar el número de veces que el usuario visita la página, se puede hacer:</p>
<blockquote>
<p>&lt;?php<br />   // Iniciamos la sesión o recuperamos la anterior sesión existente<br />   session_start();<br />   // Comprobamos si la variable ya existe<br />   if (isset($_SESSION['visitas'])) $_SESSION['visitas']++;<br />   else $_SESSION['visitas'] = 0;<br />?&gt;</p>
</blockquote>
<p>Si en lugar del número de visitas, se quisiere almacenar el instante en que se produce cada una, la variable de sesión "visitas" deberá ser un array y por tanto se tendrá que cambiar el código anterior por:</p>
<blockquote>
<p>&lt;?php<br />   // Iniciamos la sesión o recuperamos la anterior sesión existente<br />   session_start();<br />   // En cada visita añadimos un valor al array "visitas" <br />   $_SESSION['visitas'][] = mktime();<br />?&gt;</p>
</blockquote>
<p>Aunque como ya se vio, se puede configurar PHP para que elimine de forma automática los datos de una sesión pasado cierto tiempo, en ocasiones puede ser necesario <strong>cerrarla de forma manual en un momento determinado.</strong> Por ejemplo, si se utilizan sesiones para recordar la información de autentificación, se deberá dar al usuario del sitio web la posibilidad de cerrar la sesión cuando lo crea conveniente. En PHP existen dos funciones para eliminar la información almacenada en la sesión:</p>
<ul>
<li><strong>session_unset.</strong> Elimina las variables almacenadas en la sesión actual, pero no elimina la información de la sesión del dispositivo de almacenamiento usado.</li>
<li><strong>session_destroy</strong>. Elimina completamente la información de la sesión del dispositivo de almacenamiento.</li>
</ul>
<p><a href="https://www.php.net/manual/es/features.sessions.php">Ver sesiones en php.net</a></p></div>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper textIdevice em_iDevice" id="id127">
<div class="iDevice emphasis1" >
<header class="iDevice_header iDevice_header_noIcon"><h1 class="iDeviceTitle">4.3.3. Ejemplo de la gestión de información de la sesión</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta127_127_2" class="block iDevice_content">
<div class="exe-text"><p>En este apartado se va a realizar paso a paso un ejemplo de utilización de sesiones para almacenar la información del usuario. <br />Las páginas de que constará la aplicación son las siguientes:</p>
<ul>
<li>Login (login.php). Su función es autentificar al usuario de la aplicación web. Todos los usuarios de la aplicación deberán autentificarse utilizando esta página antes de poder acceder al resto de páginas.</li>
<li>Principal (principal.php). Presenta la aplicación web una vez que el usuario se ha autenticado correctamente.</li>
<li>Logoff (logoff.php). Esta página desconecta al usuario de la aplicación y redirige al usuario de forma automática a la pantalla de autentificación. No muestra ninguna información en pantalla, por lo que no es visible para el usuario.</li>
</ul></div>
</div>
</div>
</div>
</div>
</article>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Reconocimiento Compartir igual 4.0</a></p>
</div>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="42_cookies.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="44_mecanismos_de_mantenimiento_del_estado.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<p id="made-with-eXe"><a href="https://exelearning.net/" target="_blank" rel="noopener"><span>Creado con eXeLearning<span> (Ventana nueva)</span></span></a></p><script type="text/javascript" src="_intef_js.js"></script></body></html>